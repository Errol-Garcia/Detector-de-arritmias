<!DOCTYPE html>
<html>
<head>    
    <script src="https://code.highcharts.com/highcharts.js"></script>
</head>
<body>
    <div id="ecg-plot2"></div>

    <script>
        // Cargar los datos del archivo JSON
        var datosall;
        fetch('./api/datos.json')  // Ruta al archivo JSON
            .then(response => response.json())
            .then(data => {
                datosall=data;
                const initialData = data;

            const seriesData = [
                { name: 'No Arritmia', color: 'black', data: [] },
                { name: 'Con Arritmia', color: 'red', data: [] }
            ];

            // Crear el gráfico
            const chart = Highcharts.chart('ecg-plot2', {
                chart: {
                    type: 'line',
                    animation: Highcharts.svg, 
                },
                title: {
                    text: 'Cardiograma Animado'
                },
                xAxis: {
                    title: {
                        text: 'Tiempo'
                    }
                },
                yAxis: {
                    title: {
                        text: 'Amplitud'
                    }
                },
                series: seriesData
            });

            
            let index = 0;
            const interval = 50; // Intervalo
            datos=initialData.datos.flat()
            function addPoint() {
                
                if (index < datos.length) {                    
                    
                    
                    if (index < 2000) {
                        for(i=0;i<80;i++){
                            const point =  { x: index, y: datos[index]};
                            chart.series[0].addPoint(point, true, false);
                            index+=1;
                        }
                    } 
                    else {
                        pointlast={ x: index-1, y: datos[index-1]}
                        if(index==2000)chart.series[1].addPoint(pointlast, true, false);
                        for(i=0;i<80;i++){
                            const point =  { x: index, y: datos[index]};
                            chart.series[1].addPoint(point, true, false);
                            index+=1;
                        }                        
                        
                    } 
                    
                    // Eliminar el punto más antiguo para mantener solo 578 puntos visibles
                    if (index>578){
                        for(i=0;i<100;i++){
                            if (chart.series[0].data.length > 0) {
                                chart.series[0].data[0].remove(false);
                            }
                            else{
                                chart.series[1].data[0].remove(false);
                            }

                        }
                        
                        
                    }
                   
                    chart.redraw();
                    //index+=1;
                    
                } else {
                    clearInterval(timer);
                }
            }

            const timer = setInterval(addPoint, interval);
            })
            .catch(error => console.error('Error al cargar los datos:', error));
    </script>
</body>
</html>
